# Домашнее задание к занятию 3 «Резервное копирование»

### Задание 1
- Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию `/tmp/backup`
- Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
- Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
- На проверку направить скриншот с командой и результатом ее выполнения

#### Ответ

Команда rsync для создания зеркальной копии домашней директории пользователя в директорию /tmp/backup с исключением скрытых директорий и подсчетом хэш-сумм:

```
rsync -avPh --delete --checksum --exclude '.*' ~/ /tmp/backup/
```

Описание опций:

- `-a` - режим архива, включает рекурсивную передачу файлов, сохранение прав доступа, времени модификации и т.д.
- `-v` - режим вывода подробной информации о процессе синхронизации.
- `-P` - режим вывода прогресса передачи файлов.
- `-h` - режим вывода размеров файлов в удобочитаемом формате.
- `--delete` - удаление файлов в приемнике, которых нет в источнике.
- `--checksum` - подсчет хэш-сумм для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
- `--exclude '.*'` - исключение скрытых директорий и файлов, начинающихся с точки.
- `~/` - исходная директория, которую нужно скопировать.
- `/tmp/backup/` - целевая директория, куда нужно скопировать файлы.

![image](https://github.com/elisar83/sflt-homeworks/assets/122297912/9359ad16-a2a2-4c47-a219-f827da1ca538)


### Задание 2
- Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
- Резервная копия должна быть полностью зеркальной
- Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
- Резервная копия размещается локально, в директории `/tmp/backup`
- На проверку направить файл crontab и скриншот с результатом работы утилиты.

#### Ответ

Для начала нужно создать скрипт, который будет выполнять резервное копирование с помощью rsync. Создадим файл backup.sh в директории /usr/local/bin/:

```
#!/bin/bash

# Путь к директории, которую нужно скопировать
SOURCE_DIR="/home/samsonov"

# Путь к директории, в которую будет сохраняться резервная копия
BACKUP_DIR="/tmp/backup"

# Команда rsync для создания зеркальной копии
rsync -av --delete --exclude '.*' --checksum "$SOURCE_DIR" "$BACKUP_DIR"

# Проверяем код возврата rsync и записываем сообщение в системный лог
if [ $? -eq 0 ]; then
    logger "Backup of $SOURCE_DIR completed successfully"
else
    logger "Backup of $SOURCE_DIR failed"
fi
```

В этом скрипте мы задаем путь к директории, которую нужно скопировать (SOURCE_DIR), путь к директории, в которую будет сохраняться резервная копия (BACKUP_DIR), а также команду rsync для создания зеркальной копии. Мы исключаем скрытые файлы и директории с помощью опции --exclude '.*', а также задаем опцию --checksum для того, чтобы rsync подсчитывал хэш-суммы для всех файлов.

Теперь нужно настроить задачу в cron для регулярного запуска скрипта. Для этого выполним команду crontab -e и добавим следующую строку:

```
30 2 * * * /usr/local/bin/backup.sh
```

Эта строка означает, что скрипт будет запускаться каждый день в 2:30 ночи. 

Теперь каждый день в системном логе будет появляться запись об успешном или неуспешном выполнении операции резервного копирования. Резервная копия будет создаваться в директории /tmp/backup.

---

#### Результат выполнения команды

![image](https://github.com/elisar83/sflt-homeworks/assets/122297912/e1a4acfd-04a3-4cd7-a9a2-e5b51e872337)



